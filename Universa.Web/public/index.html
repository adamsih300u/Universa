<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universa</title>
    <style>
        :root {
            --sidebar-width: 250px;
            --chat-sidebar-width: 300px;
            --header-height: 60px;
            --primary-color: #2563eb;
            --sidebar-bg: #1e293b;
            --content-bg: #f8fafc;
            --text-light: #f1f5f9;
            --text-dark: #334155;
            --border-color: #e2e8f0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            color: var(--text-dark);
            background-color: var(--content-bg);
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar-container {
            position: fixed;
            height: 100vh;
            display: flex;
            z-index: 10;
            transition: width 0.3s ease;
            width: var(--sidebar-width);
        }

        /* Unpinned state */
        .sidebar-container.unpinned {
            width: 10px;
        }

        .sidebar-container.unpinned .sidebar {
            transform: translateX(calc(-100%));
            pointer-events: none;
        }

        .sidebar-container.unpinned:hover {
            width: var(--sidebar-width);
        }

        .sidebar-container.unpinned:hover .sidebar {
            transform: translateX(0);
            pointer-events: auto;
        }

        .sidebar {
            min-width: 200px;
            max-width: 600px;
            width: var(--sidebar-width);
            background-color: var(--sidebar-bg);
            color: var(--text-light);
            padding: 0;
            display: flex;
            flex-direction: column;
            position: relative;
            height: 100%;
            padding-bottom: 28px; /* Add space for status bar */
        }

        .sidebar-header {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        /* Add a content wrapper for the scrollable sections */
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            min-height: 0; /* Important for nested flex scrolling */
        }

        .sidebar-section {
            margin-bottom: 1.5rem;
        }

        /* Ensure the last section doesn't have a margin */
        .sidebar-section:last-child {
            margin-bottom: 0;
            flex: 1;
        }

        .sidebar-section-title {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.875rem;
            font-weight: 500;
            padding: 0.25rem 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .nav-list {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 0.125rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.375rem 0.75rem;
            color: var(--text-light);
            text-decoration: none;
            border-radius: 0.375rem;
            transition: background-color 0.2s;
            font-size: 0.9375rem;
        }

        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .nav-link.active {
            background-color: rgba(255, 255, 255, 0.15);
        }

        /* Nested navigation styles */
        .nav-list .nav-list {
            margin-left: 0.75rem;
        }

        .nav-list .nav-list .nav-link {
            padding-left: 1.25rem;
        }

        /* Icon placeholders */
        .nav-link::before {
            content: '';
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-right: 0.5rem;
            background-color: rgba(255, 255, 255, 0.5);
            mask-size: cover;
            -webkit-mask-size: cover;
        }

        .nav-link.folder::before {
            mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z' /%3E%3C/svg%3E");
        }

        /* Main Content Area */
        .main-content {
            margin: 0 var(--chat-sidebar-width) 0 var(--effective-sidebar-width);
            flex: 1;
            padding: 2rem;
            display: flex;
            min-height: 100vh;
            padding-bottom: calc(2rem + 28px); /* Add status bar height to padding */
            overflow: hidden;
            transition: margin-left 0.3s ease;
        }

        /* Tabs Container */
        .tabs-wrapper {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
        }

        .tabs-header {
            display: flex;
            overflow-x: auto;
            background: var(--content-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 0.5rem 0.5rem 0;
            gap: 0.25rem;
        }

        .tab {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 0.375rem 0.375rem 0 0;
            cursor: pointer;
            user-select: none;
            border: 1px solid var(--border-color);
            border-bottom: none;
            margin-bottom: -1px;
        }

        .tab.active {
            background: white;
            border-bottom: 1px solid white;
        }

        .tab-close {
            width: 20px;
            height: 20px;
            border: none;
            background: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--text-dark);
            opacity: 0.5;
        }

        .tab-close:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.1);
        }

        .tabs-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-dark);
            opacity: 0.5;
            padding: 2rem;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
        }

        .file-tree {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .file-tree li {
            margin: 0;
            padding: 0;
        }

        .file-tree .folder-toggle {
            cursor: pointer;
            user-select: none;
        }

        .file-tree .folder-toggle::before {
            content: '▾';
            display: inline-block;
            margin-right: 5px;
            transition: transform 0.2s;
        }

        .file-tree .folder-toggle.collapsed::before {
            transform: rotate(-90deg);
        }

        .file-tree ul {
            margin-left: 1.5rem;
        }

        .file-tree .collapsed + ul {
            display: none;
        }

        .markdown-tab {
            display: flex;
            flex-direction: column;
            flex: 1;
            position: relative;
            z-index: 1;
            background: white;
            overflow: hidden;
        }

        .tab-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: var(--content-bg);
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .document-stats {
            display: flex;
            gap: 1rem;
            color: var(--text-dark);
            font-size: 0.875rem;
        }

        .editor-container {
            flex: 1;
            position: relative;
            height: calc(100% - 48px);
        }

        .markdown-editor {
            padding: 1rem;
            border: none;
            resize: none;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 1rem;
            line-height: 1.5;
            outline: none;
            overflow-y: auto;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            background: white;
        }

        .version-select {
            padding: 0.25rem;
            border-radius: 0.25rem;
            border: 1px solid var(--border-color);
        }

        .save-btn {
            padding: 0.25rem 1rem;
            border-radius: 0.25rem;
            border: none;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
        }

        .save-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Resizable sidebar styles */
        .resize-handle {
            width: 4px;
            background-color: var(--border-color);
            cursor: col-resize;
            transition: background-color 0.2s;
        }

        .resize-handle:hover,
        .resize-handle.dragging {
            background-color: var(--primary-color);
        }

        /* File Library Section */
        #file-tree {
            flex: 1;
            overflow-y: auto;
            margin-right: -0.5rem;
            padding-right: 0.5rem;
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent; /* Firefox */
        }

        /* Webkit (Chrome, Safari, Edge) scrollbar styles */
        #file-tree::-webkit-scrollbar {
            width: 6px;
            background-color: transparent;
        }

        #file-tree::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        #file-tree:hover::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Add these styles */
        .sidebar-container.unpinned .resize-handle {
            display: none;
        }

        .pin-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 24px;
            height: 24px;
            border: none;
            background: none;
            color: var(--text-light);
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
            transition: all 0.2s;
            z-index: 30;
        }

        .pin-button:hover {
            opacity: 1;
        }

        .pin-button svg {
            width: 16px;
            height: 16px;
            transition: transform 0.3s ease;
        }

        .sidebar-container:hover .pin-button {
            opacity: 0.7;
        }

        /* Show a hint strip when unpinned */
        .sidebar-hint {
            display: none;
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 10px;
            background-color: var(--primary-color);
            opacity: 0.15;
            transition: opacity 0.2s;
            cursor: pointer;
            z-index: 20;
        }

        .sidebar-container.unpinned .sidebar-hint {
            display: block;
        }

        .sidebar-container.unpinned:hover .sidebar-hint {
            opacity: 0.3;
            width: 10px;
        }

        /* Add a subtle arrow indicator */
        .sidebar-hint::after {
            content: '›';
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .sidebar-container.unpinned:hover .sidebar-hint::after {
            opacity: 1;
        }

        /* Use a different pin icon for each state */
        .sidebar-container.unpinned .pin-button svg {
            transform: rotate(-90deg);
        }

        /* Add styles for pinned/unpinned states */
        .pin-button .pinned,
        .pin-button .unpinned {
            display: none;
        }

        .sidebar-container:not(.unpinned) .pin-button .pinned {
            display: block;
        }

        .sidebar-container.unpinned .pin-button .unpinned {
            display: block;
        }

        /* Right Chat Sidebar */
        .chat-sidebar-container {
            position: fixed;
            right: 0;
            height: 100vh;
            display: flex;
            z-index: 10;
            transition: width 0.3s ease;
            width: var(--chat-sidebar-width);
        }

        .chat-sidebar-container.unpinned {
            width: 10px;
            right: 0;
        }

        .chat-sidebar {
            width: var(--chat-sidebar-width);
            background-color: var(--sidebar-bg);
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            height: 100%;
            transition: transform 0.3s ease;
            position: absolute;
            right: 0;
            padding-bottom: 28px; /* Add space for status bar */
        }

        .chat-sidebar-container.unpinned .chat-sidebar {
            transform: translateX(100%);
            pointer-events: none;
        }

        .chat-sidebar-container.unpinned:hover .chat-sidebar {
            transform: translateX(0);
            pointer-events: auto;
        }

        .chat-hint {
            display: none;
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 10px;
            background-color: var(--primary-color);
            opacity: 0.15;
            transition: opacity 0.2s;
            cursor: pointer;
            z-index: 20;
        }

        .chat-sidebar-container.unpinned .chat-hint {
            display: block;
        }

        .chat-sidebar-container.unpinned:hover .chat-hint {
            opacity: 0.3;
        }

        /* Chat Interface Components */
        .model-selector {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .model-selector select {
            width: 100%;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-light);
            border-radius: 0.375rem;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .chat-input-container {
            padding: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 0.5rem;
        }

        .chat-input {
            flex: 1;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-light);
            border-radius: 0.375rem;
            resize: none;
            min-height: 38px;
            max-height: 200px;
        }

        .send-button {
            padding: 0.5rem 1rem;
            background: var(--primary-color);
            border: none;
            color: white;
            border-radius: 0.375rem;
            cursor: pointer;
        }

        .send-button:hover {
            opacity: 0.9;
        }

        /* Add styles for the bottom section of the sidebar */
        .sidebar-footer {
            margin-top: auto;
            padding: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.875rem;
            flex-shrink: 0; /* Prevent footer from shrinking */
            background-color: var(--sidebar-bg);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-light);
            opacity: 0.8;
        }

        .user-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        .settings-button {
            background: none;
            border: none;
            color: var(--text-light);
            opacity: 0.7;
            cursor: pointer;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.2s;
        }

        .settings-button:hover {
            opacity: 1;
        }

        /* Add status bar styles */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 28px;
            background-color: var(--sidebar-bg);
            color: var(--text-light);
            display: flex;
            align-items: center;
            padding: 0 1rem;
            font-size: 0.875rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
        }

        .status-bar-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            opacity: 0.8;
        }

        .status-bar-item:not(:last-child)::after {
            content: '•';
            margin-left: 0.5rem;
            opacity: 0.5;
        }

        /* Settings Modal Styles */
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .settings-content {
            background: var(--sidebar-bg);
            border-radius: 0.5rem;
            width: 600px;
            max-width: 90vw;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            color: var(--text-light);
        }

        .settings-header {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-tabs {
            display: flex;
            padding: 1rem 1rem 0;
            gap: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-tab-btn {
            padding: 0.5rem 1rem;
            background: none;
            border: none;
            color: var(--text-light);
            opacity: 0.7;
            cursor: pointer;
        }

        .settings-tab-btn.active {
            opacity: 1;
            border-bottom: 2px solid var(--primary-color);
        }

        .settings-body {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .settings-tab-content {
            display: none;
        }

        .settings-tab-content.active {
            display: block;
        }

        .settings-footer {
            padding: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: flex-end;
        }

        /* Settings form styles */
        .settings-group {
            margin-bottom: 1.5rem;
        }

        .settings-group h3 {
            margin-bottom: 0.5rem;
            color: var(--text-light);
            font-size: 1rem;
        }

        .settings-group label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-light);
        }

        .settings-group input[type="text"],
        .settings-group input[type="password"],
        .settings-group select {
            width: 100%;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-light);
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
        }

        .settings-group input[type="checkbox"] {
            width: 1rem;
            height: 1rem;
        }

        .save-settings {
            padding: 0.5rem 1rem;
            background: var(--primary-color);
            border: none;
            color: white;
            border-radius: 0.375rem;
            cursor: pointer;
        }

        .save-settings:hover {
            opacity: 0.9;
        }

        .close-settings {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            opacity: 0.7;
        }

        .close-settings:hover {
            opacity: 1;
        }

        .empty-state {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            padding: 2rem;
            text-align: center;
            color: var(--text-dark);
            background: rgba(255, 255, 255, 0.5);
            border-radius: 0.5rem;
            margin: 1rem;
        }
        
        .empty-state-content {
            max-width: 300px;
        }
        
        .empty-state svg {
            color: var(--text-dark);
            opacity: 0.5;
            margin-bottom: 1rem;
        }
        
        .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }
        
        .empty-state p {
            color: var(--text-dark);
            opacity: 0.7;
            font-size: 0.875rem;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar-container">
        <div class="sidebar-hint"></div>
        <nav class="sidebar">
            <div class="sidebar-header">
                <h1>Universa</h1>
                <button class="pin-button" title="Pin/unpin sidebar">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M6 5v14M18 5v14M6 12h12"/>
                    </svg>
                </button>
            </div>

            <div class="sidebar-content">
                <!-- Services Section -->
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Services</div>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="#" class="nav-link">Jellyfin</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link">Matrix</a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link">RSS</a>
                        </li>
                    </ul>
                </div>

                <!-- File Library Section -->
                <div class="sidebar-section">
                    <div class="sidebar-section-title">File Library</div>
                    <div class="file-list">
                        <div id="empty-state" class="empty-state" style="display: none;">
                            <div class="empty-state-content">
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
                                    <polyline points="13 2 13 9 20 9"></polyline>
                                </svg>
                                <h3>No Files Yet</h3>
                                <p>Drag and drop files here or use the upload button to get started.</p>
                            </div>
                        </div>
                        <div id="file-list-content"></div>
                    </div>
                </div>
            </div>

            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">
                        <!-- Will be populated by JS -->
                    </div>
                    <span class="username">
                        <!-- Will be populated by JS -->
                    </span>
                </div>
                <button class="settings-button" title="Settings">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                </button>
            </div>
        </nav>
        <div class="resize-handle"></div>
    </div>

    <!-- Main Content Area -->
    <main class="main-content">
        <div class="tabs-wrapper">
            <div class="tabs-header"></div>
            <div class="tabs-content"></div>
        </div>
    </main>

    <!-- Add the chat sidebar HTML structure -->
    <div class="chat-sidebar-container unpinned">
        <div class="chat-hint"></div>
        <nav class="chat-sidebar">
            <div class="model-selector">
                <select id="ai-model-select">
                    <option value="">Loading models...</option>
                </select>
            </div>
            <div class="chat-messages" id="chat-messages">
                <!-- Messages will be inserted here -->
            </div>
            <div class="chat-input-container">
                <textarea 
                    class="chat-input" 
                    placeholder="Type your message..."
                    rows="1"
                    id="chat-input"
                ></textarea>
                <button class="send-button" id="send-message">
                    Send
                </button>
            </div>
        </nav>
    </div>

    <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-bar-item date-time"></div>
        <div class="status-bar-item moon-phase">
            <span class="moon-icon"></span>
            <span class="moon-text">Waxing Crescent</span>
        </div>
        <div class="status-bar-item weather">
            <span class="weather-icon">⛅</span>
            <span class="weather-text">Loading weather...</span>
        </div>
    </div>

    <!-- Add Settings Modal HTML -->
    <div class="settings-modal" style="display: none;">
        <div class="settings-content">
            <div class="settings-header">
                <h2>Settings</h2>
                <button class="close-settings">×</button>
            </div>
            <div class="settings-tabs">
                <button class="settings-tab-btn active" data-tab="ai">AI</button>
                <button class="settings-tab-btn" data-tab="theme">Theme</button>
                <button class="settings-tab-btn" data-tab="weather">Weather</button>
            </div>
            <div class="settings-body">
                <div class="settings-tab-content active" id="ai-settings">
                    <!-- AI settings form will be dynamically populated -->
                </div>
                <div class="settings-tab-content" id="theme-settings">
                    <!-- Theme settings form will be dynamically populated -->
                </div>
                <div class="settings-tab-content" id="weather-settings">
                    <!-- Weather settings form will be dynamically populated -->
                </div>
            </div>
            <div class="settings-footer">
                <button class="save-settings">Save Changes</button>
            </div>
        </div>
    </div>

    <script>
        // Simple tab switching functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs and content
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab
                tab.classList.add('active');
                
                // Show corresponding content
                const index = Array.from(tab.parentElement.children).indexOf(tab);
                document.querySelectorAll('.tab-content')[index].classList.add('active');
            });
        });

        // Add this near the top of your script section
        const FOLDER_STATES_KEY = 'folderStates';

        // Function to load saved folder states
        function loadFolderStates() {
            try {
                const saved = localStorage.getItem(FOLDER_STATES_KEY);
                return saved ? JSON.parse(saved) : {};
            } catch (error) {
                console.error('Error loading folder states:', error);
                return {};
            }
        }

        // Function to save folder states
        function saveFolderStates(states) {
            try {
                localStorage.setItem(FOLDER_STATES_KEY, JSON.stringify(states));
            } catch (error) {
                console.error('Error saving folder states:', error);
            }
        }

        // Update the buildTreeFromFiles function in index.html to match the FileMetadata structure
        function buildTreeFromFiles(files) {
            console.log("Building tree from files:", files);
            const root = [];
            const map = new Map();

            files.forEach(file => {
                // Skip files/folders that start with a dot
                if (file.relativePath.split('/').some(part => part.startsWith('.'))) {
                    return;
                }

                console.log("Processing file:", file);
                const parts = file.relativePath.split('/');
                let current = root;

                parts.forEach((part, index) => {
                    // Skip this iteration if the part starts with a dot
                    if (part.startsWith('.')) {
                        return;
                    }

                    const isLast = index === parts.length - 1;
                    const path = parts.slice(0, index + 1).join('/');
                    let node = map.get(path);

                    if (!node) {
                        node = {
                            name: part,
                            isDir: !isLast || file.isDirectory,
                            children: []
                        };
                        map.set(path, node);
                        current.push(node);
                    }

                    current = node.children;
                });
            });

            // Sort function for the tree
            const sortNodes = (nodes) => {
                nodes.sort((a, b) => {
                    if (a.isDir !== b.isDir) return b.isDir - a.isDir;
                    return a.name.localeCompare(b.name);
                });
                nodes.forEach(node => {
                    if (node.children) sortNodes(node.children);
                });
            };

            sortNodes(root);
            console.log("Final tree structure:", root);
            return root;
        }

        // Modify the renderFileTree function
        function renderFileTree(node, parentElement = document.getElementById('file-tree')) {
            parentElement.innerHTML = ''; // Clear loading message
            const folderStates = loadFolderStates();
            
            function createTreeNode(item, path) {
                const li = document.createElement('li');
                const link = document.createElement('a');
                link.href = '#';
                link.className = 'nav-link' + (item.isDir ? ' folder' : '');
                link.textContent = item.name;
                
                if (item.isDir) {
                    link.classList.add('folder-toggle');
                    // Start collapsed unless we have a saved state
                    const isExpanded = folderStates[path] ?? false;
                    if (!isExpanded) {
                        link.classList.add('collapsed');
                    }
                    
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        link.classList.toggle('collapsed');
                        
                        // Save the new state
                        const states = loadFolderStates();
                        states[path] = !link.classList.contains('collapsed');
                        saveFolderStates(states);
                    });
                    
                    const ul = document.createElement('ul');
                    ul.className = 'nav-list';
                    if (item.children) {
                        item.children.forEach(child => {
                            const childPath = path + '/' + child.name;
                            ul.appendChild(createTreeNode(child, childPath));
                        });
                    }
                    
                    li.appendChild(link);
                    li.appendChild(ul);
                } else {
                    li.appendChild(link);
                }
                
                link.addEventListener('click', async (e) => {
                    e.preventDefault();
                    if (item.name.endsWith('.md')) {
                        tabManager.openTab(path);
                    }
                });
                
                return li;
            }
            
            const ul = document.createElement('ul');
            ul.className = 'nav-list';
            node.forEach(item => {
                ul.appendChild(createTreeNode(item, item.name));
            });
            parentElement.appendChild(ul);
        }

        // Update the loadFileTree function with better error handling
        async function loadFileTree() {
            try {
                console.log("Starting file tree load...");
                const response = await fetch('/api/files');
                
                if (!response.ok) {
                    console.error("Server response not OK:", response.status, response.statusText);
                    throw new Error(`Failed to load file structure: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log("Received data:", data);
                
                if (!data.files || !Array.isArray(data.files)) {
                    console.error("Invalid data format received:", data);
                    throw new Error("Invalid data format received from server");
                }
                
                const tree = buildTreeFromFiles(data.files);
                console.log("Built tree structure:", tree);
                
                renderFileTree(tree);
            } catch (error) {
                console.error('Error loading file structure:', error);
                document.getElementById('file-tree').innerHTML = 
                    `<div class="error">Error loading file structure: ${error.message}</div>`;
            }
        }

        // Load the file tree when the page loads
        document.addEventListener('DOMContentLoaded', loadFileTree);

        // Add these utility functions
        function getWordCount(text) {
            return text.trim().split(/\s+/).filter(word => word.length > 0).length;
        }

        function getCharCount(text) {
            return text.length;
        }

        function getReadTime(wordCount) {
            const wordsPerMinute = 200;
            const minutes = Math.ceil(wordCount / wordsPerMinute);
            return minutes === 1 ? "1 minute" : `${minutes} minutes`;
        }

        function getFileVersions(filePath) {
            const dirPath = filePath.substring(0, filePath.lastIndexOf('/'));
            const fileName = filePath.substring(filePath.lastIndexOf('/') + 1);
            return fetch(`/api/files/${dirPath}/.versions/${fileName}`)
                .then(response => response.json())
                .catch(() => []);
        }

        // Add the MarkdownTab class
        class MarkdownTab {
            constructor(filePath) {
                this.filePath = filePath;
                this.fileName = filePath.split('/').pop();
                this.content = '';
                this.versions = [];
                this.element = null;
                this.editor = null;
                this.isDirty = false;
            }

            async init() {
                // Load file content
                const response = await fetch(`/api/files/${this.filePath}`);
                this.content = await response.text();
                
                // Load versions
                this.versions = await getFileVersions(this.filePath);
                
                // Create tab UI
                this.element = document.createElement('div');
                this.element.className = 'markdown-tab';
                this.render();
                
                return this;
            }

            render() {
                const wordCount = getWordCount(this.content);
                this.element.innerHTML = `
                    <div class="tab-toolbar">
                        <div class="version-control">
                            <select class="version-select">
                                <option value="current">Current</option>
                                ${this.versions.map(v => `
                                    <option value="${v.hash}">${new Date(v.modTime).toLocaleString()}</option>
                                `).join('')}
                            </select>
                        </div>
                        <div class="document-stats">
                            <span class="word-count">${wordCount} words</span>
                            <span class="char-count">${getCharCount(this.content)} characters</span>
                            <span class="read-time">${getReadTime(wordCount)} read</span>
                        </div>
                        <div class="actions">
                            <button class="save-btn" ${!this.isDirty ? 'disabled' : ''}>Save</button>
                        </div>
                    </div>
                    <div class="editor-container">
                        <textarea class="markdown-editor">${this.content.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')}</textarea>
                    </div>
                `;

                // Get direct reference to the editor
                this.editor = this.element.querySelector('.markdown-editor');
                
                // Set the content directly to preserve formatting
                this.editor.value = this.content;

                // Set up event listeners
                this.editor.addEventListener('input', () => {
                    this.isDirty = true;
                    this.updateStats();
                    this.element.querySelector('.save-btn').disabled = false;
                });

                this.element.querySelector('.save-btn').addEventListener('click', () => this.save());
                this.element.querySelector('.version-select').addEventListener('change', (e) => this.loadVersion(e.target.value));
            }

            updateStats() {
                const content = this.element.querySelector('.markdown-editor').value;
                const wordCount = getWordCount(content);
                
                this.element.querySelector('.word-count').textContent = `${wordCount} words`;
                this.element.querySelector('.char-count').textContent = `${getCharCount(content)} characters`;
                this.element.querySelector('.read-time').textContent = `${getReadTime(wordCount)} read`;
            }

            async save() {
                const content = this.element.querySelector('.markdown-editor').value;
                
                // Create form data for file upload
                const formData = new FormData();
                const blob = new Blob([content], { type: 'text/markdown' });
                formData.append('file', blob, this.fileName);
                formData.append('relativePath', this.filePath);

                // Save the file
                await fetch('/api/files', {
                    method: 'POST',
                    body: formData
                });

                this.isDirty = false;
                this.element.querySelector('.save-btn').disabled = true;
            }

            async loadVersion(hash) {
                if (hash === 'current') {
                    const response = await fetch(`/api/files/${this.filePath}`);
                    this.content = await response.text();
                } else {
                    const response = await fetch(`/api/files/${this.filePath}/.versions/${hash}`);
                    this.content = await response.text();
                }
                
                this.element.querySelector('.markdown-editor').value = this.content;
                this.updateStats();
            }
        }

        // Add this JavaScript for sidebar resizing
        function initResizableSidebar() {
            const handle = document.querySelector('.resize-handle');
            const sidebar = document.querySelector('.sidebar');
            let isResizing = false;

            handle.addEventListener('mousedown', (e) => {
                isResizing = true;
                handle.classList.add('dragging');
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', stopResize);
                e.preventDefault();
            });

            function handleMouseMove(e) {
                if (!isResizing) return;
                
                const newWidth = e.clientX;
                if (newWidth >= 200 && newWidth <= 600) {
                    document.documentElement.style.setProperty('--sidebar-width', `${newWidth}px`);
                    document.documentElement.style.setProperty('--effective-sidebar-width', `${newWidth + 4}px`);
                    localStorage.setItem('sidebarWidth', newWidth);
                }
            }

            function stopResize() {
                isResizing = false;
                handle.classList.remove('dragging');
                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('mouseup', stopResize);
            }

            // Restore saved width
            const savedWidth = localStorage.getItem('sidebarWidth');
            if (savedWidth) {
                document.documentElement.style.setProperty('--sidebar-width', `${savedWidth}px`);
                document.documentElement.style.setProperty('--effective-sidebar-width', `${savedWidth + 4}px`);
            }
        }

        // Add this TabManager class near your other classes
        class TabManager {
            constructor(container) {
                this.container = container;
                this.tabs = new Map();
                this.activeTab = null;
                
                // Create tab header and content containers
                this.headerContainer = container.querySelector('.tabs-header');
                this.contentContainer = container.querySelector('.tabs-content');
                
                // Clear default content
                this.headerContainer.innerHTML = '';
                this.contentContainer.innerHTML = '';
                this.showEmptyState();
            }
            
            async openTab(path, type = 'markdown') {
                // Check if tab already exists
                if (this.tabs.has(path)) {
                    this.activateTab(path);
                    return;
                }
                
                // Clear empty state if it exists
                const emptyState = this.contentContainer.querySelector('.empty-state');
                if (emptyState) {
                    emptyState.remove();
                }
                
                // Create new tab
                const fileName = path.split('/').pop();
                const tabButton = document.createElement('div');
                tabButton.className = 'tab';
                tabButton.innerHTML = `
                    <span class="tab-title">${fileName}</span>
                    <button class="tab-close">×</button>
                `;
                
                // Add click handlers
                tabButton.addEventListener('click', () => this.activateTab(path));
                tabButton.querySelector('.tab-close').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.closeTab(path);
                });
                
                this.headerContainer.appendChild(tabButton);
                
                // Create tab content
                let tabContent;
                if (type === 'markdown') {
                    tabContent = await new MarkdownTab(path).init();
                    this.tabs.set(path, {
                        button: tabButton,
                        content: tabContent
                    });
                }
                
                this.activateTab(path);
            }
            
            activateTab(path) {
                // Deactivate current tab
                if (this.activeTab) {
                    const current = this.tabs.get(this.activeTab);
                    current.button.classList.remove('active');
                    current.content.element.style.display = 'none';
                }
                
                // Activate new tab
                const tab = this.tabs.get(path);
                tab.button.classList.add('active');
                
                // Ensure content is in container
                if (!tab.content.element.parentElement) {
                    this.contentContainer.appendChild(tab.content.element);
                }
                tab.content.element.style.display = 'block';
                
                this.activeTab = path;
            }
            
            closeTab(path) {
                const tab = this.tabs.get(path);
                if (!tab) return;
                
                // Remove DOM elements
                tab.button.remove();
                tab.content.element.remove();
                
                // Remove from tabs map
                this.tabs.delete(path);
                
                // If this was the active tab, activate another one
                if (this.activeTab === path) {
                    this.activeTab = null;
                    const nextTab = this.tabs.keys().next().value;
                    if (nextTab) {
                        this.activateTab(nextTab);
                    } else {
                        // Show empty state when no tabs are open
                        this.showEmptyState();
                    }
                }
            }
            
            showEmptyState() {
                // Clear any existing content
                this.contentContainer.innerHTML = '';
                this.contentContainer.innerHTML = `
                    <div class="empty-state">
                        <h2>Welcome to Universa</h2>
                        <p>Open a file from the sidebar to get started.</p>
                    </div>
                `;
            }
        }

        // Initialize the tab manager
        let tabManager;
        document.addEventListener('DOMContentLoaded', () => {
            const tabsContainer = document.querySelector('.tabs-wrapper');
            tabManager = new TabManager(tabsContainer);
            tabManager.showEmptyState();
            
            initResizableSidebar();
            initSidebarPin();
            loadFileTree();
            initChatSidebar();
            initStatusBar();
            initSettingsModal();
        });

        // Add this to your JavaScript
        async function initSidebarPin() {
            const sidebarContainer = document.querySelector('.sidebar-container');
            const pinButton = document.querySelector('.pin-button');
            await initUserInfo();
            
            // Set initial state from localStorage
            const isPinned = localStorage.getItem('sidebarPinned') !== 'false'; // Default to pinned
            if (!isPinned) {
                sidebarContainer.classList.add('unpinned');
                document.documentElement.style.setProperty('--effective-sidebar-width', '10px');
            } else {
                document.documentElement.style.setProperty(
                    '--effective-sidebar-width',
                    `calc(${getComputedStyle(document.documentElement).getPropertyValue('--sidebar-width')} + 4px)`
                );
            }
            
            pinButton.addEventListener('click', () => {
                sidebarContainer.classList.toggle('unpinned');
                const isNowPinned = !sidebarContainer.classList.contains('unpinned');
                localStorage.setItem('sidebarPinned', isNowPinned);
                
                document.documentElement.style.setProperty(
                    '--effective-sidebar-width',
                    !isNowPinned ? '10px' : `calc(${getComputedStyle(document.documentElement).getPropertyValue('--sidebar-width')} + 4px)`
                );
                
                // Force a reflow to ensure the transition works properly
                sidebarContainer.offsetHeight;
            });
        }

        async function initUserInfo() {
            try {
                const username = window.localStorage.getItem('auth_username');
                if (username) {
                    const avatarEl = document.querySelector('.user-avatar');
                    const usernameEl = document.querySelector('.username');
                    
                    // Set avatar initials
                    avatarEl.textContent = username.substring(0, 2).toUpperCase();
                    usernameEl.textContent = username;
                } else {
                    const response = await fetch('/api/user');
                    const user = await response.json();
                    
                    const avatarEl = document.querySelector('.user-avatar');
                    const usernameEl = document.querySelector('.username');
                    
                    if (user && user.username) {
                        // Set avatar initials
                        avatarEl.textContent = user.username.substring(0, 2).toUpperCase();
                        usernameEl.textContent = user.username;
                    } else {
                        avatarEl.textContent = '?';
                        usernameEl.textContent = 'Guest';
                    }
                }
            } catch (error) {
                console.error('Failed to load user info:', error);
                // Set fallback user info
                document.querySelector('.user-avatar').textContent = '?';
                document.querySelector('.username').textContent = 'Guest';
            }
        }

        // Add settings button click handler
        document.querySelector('.settings-button').addEventListener('click', async () => {
            const modal = document.querySelector('.settings-modal');
            modal.style.display = 'flex';
            try {
                await loadSettings();
            } catch (error) {
                console.error('Failed to load settings:', error);
                // Show error in settings modal
                document.querySelectorAll('.settings-tab-content').forEach(content => {
                    content.innerHTML = `
                        <div class="error-message">
                            Failed to load settings. Please try again later.
                        </div>
                    `;
                });
            }
        });

        // Add settings modal functionality
        function initSettingsModal() {
            const modal = document.querySelector('.settings-modal');
            const closeBtn = document.querySelector('.close-settings');
            const saveBtn = document.querySelector('.save-settings');
            const tabBtns = document.querySelectorAll('.settings-tab-btn');

            // Close modal when clicking close button or outside the modal
            closeBtn.addEventListener('click', () => {
                modal.style.display = 'none';
            });

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });

            // Tab switching
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Remove active class from all tabs and contents
                    document.querySelectorAll('.settings-tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.settings-tab-content').forEach(c => c.classList.remove('active'));

                    // Add active class to clicked tab and its content
                    btn.classList.add('active');
                    document.getElementById(`${btn.dataset.tab}-settings`).classList.add('active');
                });
            });

            // Save settings
            saveBtn.addEventListener('click', async () => {
                await saveSettings();
                modal.style.display = 'none';
            });
        }

        // Load settings from the server
        async function loadSettings() {
            try {
                const response = await fetch('/api/config');
                if (!response.ok) {
                    throw new Error(`Failed to load settings: ${response.statusText}`);
                }
                const config = await response.json();
                
                // Populate AI settings
                const aiSettings = document.getElementById('ai-settings');
                aiSettings.innerHTML = `
                    <div class="settings-group">
                        <h3>OpenAI</h3>
                        <label>
                            <input type="checkbox" ${config.ai.openai.enabled ? 'checked' : ''} name="openai-enabled">
                            Enable OpenAI
                        </label>
                        <input type="password" value="${config.ai.openai.apiKey}" placeholder="API Key" name="openai-key">
                    </div>
                    <div class="settings-group">
                        <h3>Anthropic</h3>
                        <label>
                            <input type="checkbox" ${config.ai.anthropic.enabled ? 'checked' : ''} name="anthropic-enabled">
                            Enable Anthropic
                        </label>
                        <input type="password" value="${config.ai.anthropic.apiKey}" placeholder="API Key" name="anthropic-key">
                    </div>
                    <div class="settings-group">
                        <h3>Default Provider</h3>
                        <select name="default-provider">
                            <option value="OpenAI" ${config.ai.defaultProvider === 'OpenAI' ? 'selected' : ''}>OpenAI</option>
                            <option value="Anthropic" ${config.ai.defaultProvider === 'Anthropic' ? 'selected' : ''}>Anthropic</option>
                        </select>
                    </div>
                `;

                // Populate Theme settings
                const themeSettings = document.getElementById('theme-settings');
                themeSettings.innerHTML = `
                    <div class="settings-group">
                        <h3>Theme</h3>
                        <select name="theme">
                            <option value="Dark" ${config.theme.current === 'Dark' ? 'selected' : ''}>Dark</option>
                            <option value="Light" ${config.theme.current === 'Light' ? 'selected' : ''}>Light</option>
                        </select>
                    </div>
                `;

                // Populate Weather settings
                const weatherSettings = document.getElementById('weather-settings');
                weatherSettings.innerHTML = `
                    <div class="settings-group">
                        <label>
                            <input type="checkbox" ${config.weather.enabled ? 'checked' : ''} name="weather-enabled">
                            Enable Weather
                        </label>
                        <input type="text" value="${config.weather.zipCode}" placeholder="Zip Code" name="weather-zip">
                        <input type="password" value="${config.weather.apiKey}" placeholder="API Key" name="weather-key">
                        <label>
                            <input type="checkbox" ${config.weather.enableMoonPhase ? 'checked' : ''} name="moon-enabled">
                            Show Moon Phase
                        </label>
                    </div>
                `;
            } catch (error) {
                console.error('Failed to load settings:', error);
                // Show error in the settings modal
                document.querySelectorAll('.settings-tab-content').forEach(content => {
                    content.innerHTML = `
                        <div class="settings-error">
                            Failed to load settings: ${error.message}
                        </div>
                    `;
                });
            }
        }

        // Save settings to the server
        async function saveSettings() {
            const config = {
                ai: {
                    openai: {
                        enabled: document.querySelector('[name="openai-enabled"]').checked,
                        apiKey: document.querySelector('[name="openai-key"]').value
                    },
                    anthropic: {
                        enabled: document.querySelector('[name="anthropic-enabled"]').checked,
                        apiKey: document.querySelector('[name="anthropic-key"]').value
                    },
                    defaultProvider: document.querySelector('[name="default-provider"]').value
                },
                theme: {
                    current: document.querySelector('[name="theme"]').value
                },
                weather: {
                    enabled: document.querySelector('[name="weather-enabled"]').checked,
                    zipCode: document.querySelector('[name="weather-zip"]').value,
                    apiKey: document.querySelector('[name="weather-key"]').value,
                    enableMoonPhase: document.querySelector('[name="moon-enabled"]').checked
                }
            };

            try {
                await fetch('/api/config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(config)
                });
            } catch (error) {
                console.error('Failed to save settings:', error);
            }
        }

        // Add the chat initialization JavaScript
        async function initChatSidebar() {
            const chatContainer = document.querySelector('.chat-sidebar-container');
            const modelSelect = document.querySelector('#ai-model-select');
            const chatInput = document.querySelector('#chat-input');
            const sendButton = document.querySelector('#send-message');
            const messagesContainer = document.querySelector('#chat-messages');

            // Load available models
            try {
                const response = await fetch('/api/ai/models');
                const models = await response.json();
                modelSelect.innerHTML = models.map(model => 
                    `<option value="${model.id}">${model.name}</option>`
                ).join('');
            } catch (error) {
                console.error('Failed to load AI models:', error);
                modelSelect.innerHTML = '<option value="">No models available</option>';
            }

            // Auto-resize input
            chatInput.addEventListener('input', () => {
                chatInput.style.height = 'auto';
                chatInput.style.height = chatInput.scrollHeight + 'px';
            });

            // Handle message sending
            sendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            async function sendMessage() {
                const message = chatInput.value.trim();
                if (!message) return;

                // Add message to UI
                const messageElement = document.createElement('div');
                messageElement.textContent = message;
                messagesContainer.appendChild(messageElement);

                // Clear input
                chatInput.value = '';
                chatInput.style.height = 'auto';

                // TODO: Send to API and handle response
            }
        }

        // Add status bar initialization
        function initStatusBar() {
            const dateTimeEl = document.querySelector('.date-time');
            
            function updateDateTime() {
                const now = new Date();
                const options = {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                };
                dateTimeEl.textContent = now.toLocaleDateString('en-US', options);
            }
            
            // Update immediately and then every second
            updateDateTime();
            setInterval(updateDateTime, 1000);
        }

        async function loadFileList() {
            try {
                const response = await fetch('/api/files');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                const emptyState = document.getElementById('empty-state');
                const fileListContent = document.getElementById('file-list-content');
                
                if (!data.files || data.files.length === 0) {
                    emptyState.style.display = 'flex';
                    fileListContent.style.display = 'none';
                    return;
                }
                
                emptyState.style.display = 'none';
                fileListContent.style.display = 'block';
                
                // Existing file list rendering code...
                renderFileList(data.files);
            } catch (error) {
                const emptyState = document.getElementById('empty-state');
                const fileListContent = document.getElementById('file-list-content');
                
                emptyState.style.display = 'flex';
                fileListContent.style.display = 'none';
                
                // Update empty state message for error case
                const emptyStateContent = emptyState.querySelector('.empty-state-content');
                emptyStateContent.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    <h3>Error Loading Files</h3>
                    <p>There was a problem loading your files. Please try again later.</p>
                `;
                console.error('Error loading files:', error);
            }
        }
    </script>
</body>
</html> 